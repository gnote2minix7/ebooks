<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>E-book Purchase via QR Pay + Telegram</title>
  <meta name="description" content="Pay via QR then message me on Telegram to receive the e-book." />
  <style>
    :root{--bg:#0b0f14;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--ok:#34d399;--warn:#f59e0b;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:radial-gradient(1200px 600px at 100% -10%,#1f2937 0%,#0b0f14 60%);color:var(--text);}
    .wrap{max-width:760px;margin:0 auto;padding:24px;}
    .card{background:linear-gradient(180deg,#0f172a,#0b1020 50%,#0b0f14);border:1px solid #1f2937;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden}
    header{padding:22px 22px 10px;border-bottom:1px solid #1f2937;display:flex;align-items:center;gap:14px}
    .logo{width:44px;height:44px;border-radius:12px;background:#0ea5e9;display:grid;place-items:center;font-weight:700}
    .logo span{filter:drop-shadow(0 2px 6px rgba(0,0,0,.4));}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:14px;margin-top:2px}
    .body{padding:22px;display:grid;gap:20px}
    .grid{display:grid;grid-template-columns:1fr;gap:18px}
    @media(min-width:720px){.grid{grid-template-columns:1.2fr .8fr}}
    .panel{background:rgba(255,255,255,.02);border:1px solid #1f2937;border-radius:16px;padding:16px}
    .price{font-size:30px;font-weight:800;letter-spacing:.3px}
    .note{color:var(--muted);font-size:14px}
    input[type="email"], select {
      width: 100%;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #0b1224;
      color: var(--text);
      margin-top: 10px;
    }
    .total-price{font-size:20px;font-weight:800;margin-top:10px}
    .steps{display:grid;gap:10px;margin:10px 0 0}
    .step{display:flex;gap:10px;align-items:flex-start}
    .badge{font-variant-numeric:tabular-nums;min-width:26px;height:26px;border-radius:8px;background:#111827;border:1px solid #1f2937;display:grid;place-items:center;color:var(--accent);font-weight:700}
    .qr{display:grid;place-items:center;padding:10px}
    .qr img{width:100%;max-width:300px;border-radius:12px;border:1px solid #1f2937;background:#fff}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .btn{appearance:none;border:1px solid #1f2937;background:#0b1224;color:var(--text);padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;text-align:center;text-decoration:none;display:flex;align-items:center;justify-content:center;gap:8px;font-size:14px;}
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1d4ed8);border-color:#1e40af}
    .btn.success{background:linear-gradient(180deg,#10b981,#059669);border-color:#047857}
    .btn.tng{background:linear-gradient(180deg,#0055ab,#003d7a);border-color:#003d7a}
    .btn img.icon{width:22px;height:22px;object-fit:contain;}
    .btn svg.icon-svg{width:18px;height:18px;fill:white;}
    .btn.is-disabled, .btn:disabled {opacity:.5;pointer-events:none;cursor:not-allowed;filter:grayscale(.2);}
    .meta{display:flex;justify-content:space-between;gap:14px;flex-wrap:wrap;margin-top:6px;color:var(--muted);font-size:13px}
    footer{padding:14px 22px 22px;color:var(--muted);font-size:12px}
    code{background:#0b1224;padding:2px 6px;border-radius:6px;border:1px solid #1f2937}
    a{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo"><span>ðŸ“š</span></div>
        <div>
          <h1 id="title">Pembayaran Online: <span data-editable="true">ebooks & e-komik</span></h1>
          <div class="sub">Instant delivery via Google Drive after payment confirmation (ePub @ PDF)</div>
        </div>
      </header>

      <div class="body">
        <div class="grid">
          <section class="panel">
            <div class="total-price">Total: RM <span id="totalPrice">0.00</span></div>
            <div id="discountInfo" style="margin-top:-5px;margin-bottom:5px;"></div>
            <p class="note">Sila pilih tajuk ebooks dan masukkan gmail address untuk menerima link gdrive.</p>

            <div id="book-selection-container"></div>
            <button id="addBookBtn" class="btn" type="button">+ tambah lagi e-books</button>

            <input type="email" id="email" placeholder="Your Email Address" required />
            <p class="note">Scan the QR to pay. Then message me on Telegram with your payment receipt.</p>

            <div class="steps">
              <div class="step"><div class="badge">1</div><div>Open your banking app and choose <strong>QR Pay</strong>.</div></div>
              <div class="step"><div class="badge">2</div><div>Scan the QR code on the right and pay the exact amount.</div></div>
              <div class="step"><div class="badge">3</div><div>Click <strong>Message on Telegram</strong> and send your receipt. You'll receive the ebooks shortly.</div></div>
            </div>

            <div class="btns">
              <a id="tgLink" class="btn primary is-disabled" href="https://t.me/kokombeee" target="_blank" rel="noopener" aria-disabled="true">Message on Telegram</a>
              <button class="btn success" id="paidBtn" type="button" disabled>Hantar Resit Payment</button>
            </div>

            <div class="meta">
              <div>Pembelian 3 e-books dan lebih, dapat 5% diskaun.</div>
            </div>
          </section>

          <aside class="panel qr">
            <img id="qrImg" src="qr.png" alt="Payment QR Code" />
            <div class="note" style="text-align:center;margin-top:8px">If the QR doesn't load, <a href="#" id="qrOpen">open it</a> in a new tab.</div>

            <div style="margin-top:14px; text-align:center; display:flex; flex-direction:column; gap:10px; align-items:center;">
              <a class="btn tng"
                 href="https://payment.tngdigital.com.my/sc/bDLnx1yAeB"
                 target="_blank" rel="noopener"
                 style="min-width:240px;">
                <img class="icon" src="https://raw.githubusercontent.com/gnote2minix7/ebooks/refs/heads/main/TNGo.png" alt="TNG Icon">
                Payment via T&Go
              </a>

              <a class="btn success"
                 href="https://buy.stripe.com/cNi28rfiWdkR1fn7hj57W0v"
                 target="_blank" rel="noopener"
                 style="min-width:240px;">
                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
                Card / GrabPay / GPay
              </a>
              <div class="note" style="margin-top:6px;">Powered by TNG | Stripe | Google Pay</div>
            </div>
          </aside>
        </div>
      </div>

      <footer>
        <div>Perlukan bantuan? Message <a href="https://t.me/kokombeee" target="_blank" rel="noopener">Suzanna AR</a>.</div>
        <div style="margin-top:6px">
          <div><a href="https://gnote2minix7.blogspot.com/p/antara-kesetiaan-dan-godaan.html" target="_blank" rel="noopener">Senarai dan info lengkap e-books</a> | <a href="https://gnote2minix7.blogspot.com/p/komik-3d.html" target="_blank" rel="noopener">Senarai dan info lengkap E-komik</a></div>
          <div style="margin-top:6px">By paying you agree to the no-refund policy for digital goods. Â© <span id="year"></span></div>
        </div>
      </footer>
    </div>
  </div>

  <script>
    // ===== CONFIG (edit these values) =====
    const TELEGRAM_USERNAME = 'kokombeee';
    const QR_SRC = 'qr.png';
    const BOOKS = [
      { category: 'e-books', value: 'antarakestetiadangodaan', title: 'Antara Kesetiaan dan Godaan', price: 10.00 },
      { category: 'e-books', value: 'menantuadalahnikmat', title: 'Menantu Adalah Nikmat', price: 10.00 },
      { category: 'e-books', value: 'oranggajiitukekasihgelapku', title: 'Orang Gaji Itu, Kekasih Gelapku', price: 10.00 },
      { category: 'e-books', value: 'perjalananhidupku', title: 'Perjalanan Hidupku', price: 10.00 },
      { category: 'e-books', value: 'dilemahati', title: 'Dilema Hati', price: 5.00 },
      { category: 'e-books', value: 'dendamdanmaruah', title: 'Dendam dan Maruah', price: 8.00 },
      { category: 'e-books', value: 'dosadisebalikniqab', title: 'Dosa Disebalik Niqab', price: 10.00 },
      { category: 'e-books', value: 'dosadisebalikniqab2', title: 'Dosa Disebalik Niqab : Jilid 2', price: 10.00 },
      { category: 'e-books', value: 'cikgukuscandalku', title: 'Cikguku Scandalku', price: 10.00 },
      { category: 'e-books', value: 'tercurangtanpaniat', title: 'Tercurang Tanpa Niat', price: 8.00 },
      { category: 'e-books', value: 'ustazahnurreloaded', title: 'Ustazah Nur : Reloaded', price: 10.00 },
      { category: 'e-books', value: 'menantuadalahnikmatjilid2', title: 'Menantu Adalah Nikmat : Jilid 2', price: 10.00 },
      { category: 'e-books', value: 'villanabila', title: 'Villa Nabila', price: 8.00 },
      { category: 'e-komik', value: '10pagi', title: '10 Pagi', price: 5.00 },
      { category: 'e-komik', value: 'situkangurut', title: 'Si Tukang Urut', price: 5.00 },
      { category: 'e-komik', value: 'surti', title: 'Surti', price: 5.00 },
      { category: 'e-komik', value: 'hijabolic', title: 'Hijabolic Series', price: 8.00 },
      { category: 'e-komik', value: 'isteriyangbaik', title: 'Isteri Yang Baik', price: 5.00 },
      { category: 'e-komik', value: 'sewarumah', title: 'Sewa Rumah', price: 5.00 },
      { category: 'e-komik', value: 'kawanbaikana', title: 'Kawan Baik Anak', price: 5.00 },
      { category: 'e-komik', value: 'kontraktidakbermoral', title: 'Kontrak Tidak Bermoral', price: 5.00 },
      { category: 'e-komik', value: 'diaripengembaraan', title: 'Diari Pengembaraan', price: 5.00 },
      { category: 'e-komik', value: 'diariseorangwanita', title: 'Diari Seorang Wanita', price: 5.00 },
      { category: 'e-komik', value: 'betweenaffectionandintimacy', title: 'Between Affection and Intimacy', price: 5.00 },
      { category: 'e-komik', value: 'valentine', title: 'Valentine', price: 5.00 },
      { category: 'e-komik', value: 'younglove', title: 'Young Love', price: 5.00 }
    ];

    const tgLinkEl = document.getElementById('tgLink');
    const qrImgEl = document.getElementById('qrImg');
    const qrOpenEl = document.getElementById('qrOpen');
    const bookContainer = document.getElementById('book-selection-container');
    const totalPriceElement = document.getElementById('totalPrice');
    const discountInfo = document.getElementById('discountInfo');
    const addBookBtn = document.getElementById('addBookBtn');
    const paidBtn = document.getElementById('paidBtn');
    const emailInput = document.getElementById('email');

    if (tgLinkEl) tgLinkEl.href = `https://t.me/${TELEGRAM_USERNAME}`;
    if (qrImgEl) qrImgEl.src = QR_SRC;

    if (qrOpenEl) {
      qrOpenEl.addEventListener('click', (e) => {
        e.preventDefault();
        window.open(QR_SRC, '_blank', 'noopener');
      });
    }

    function createBookSelect() {
      const select = document.createElement('select');
      select.required = true;
      select.style.marginTop = '10px';

      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Pilih e-books anda';
      defaultOption.disabled = true;
      defaultOption.selected = true;
      select.appendChild(defaultOption);

      const ebooksGroup = document.createElement('optgroup');
      ebooksGroup.label = 'e-books';
      const ekomikGroup = document.createElement('optgroup');
      ekomikGroup.label = 'E-komik';

      BOOKS.forEach(book => {
        const option = document.createElement('option');
        option.value = book.value;
        option.textContent = `${book.title} (RM ${book.price.toFixed(2)})`;
        option.setAttribute('data-price', book.price);
        if (book.category === 'e-books') ebooksGroup.appendChild(option);
        if (book.category === 'e-komik') ekomikGroup.appendChild(option);
      });

      select.appendChild(ebooksGroup);
      select.appendChild(ekomikGroup);
      return select;
    }

    function getSelectedBooks() {
      const allSelects = bookContainer.querySelectorAll('select');
      const selectedBooks = [];
      allSelects.forEach(select => {
        const selectedOption = select.selectedOptions[0];
        if (selectedOption && selectedOption.value) {
          const title = selectedOption.textContent.split(' (RM')[0];
          const price = parseFloat(selectedOption.getAttribute('data-price'));
          selectedBooks.push({ title, price });
        }
      });
      return selectedBooks;
    }

    function updateCTAState() {
      const selectedBooks = getSelectedBooks();
      const hasBook = selectedBooks.length > 0;
      const hasValidEmail = !!emailInput && emailInput.value.trim() !== '' && emailInput.checkValidity();
      const canProceed = hasBook && hasValidEmail;

      if (paidBtn) paidBtn.disabled = !canProceed;

      if (tgLinkEl) {
        tgLinkEl.setAttribute('aria-disabled', canProceed ? 'false' : 'true');
        tgLinkEl.classList.toggle('is-disabled', !canProceed);
      }
    }

    function calculateTotal() {
      const selectedBooks = getSelectedBooks();
      const total = selectedBooks.reduce((sum, book) => sum + book.price, 0);

      let finalPrice = total;
      if (discountInfo) discountInfo.innerHTML = '';

      if (selectedBooks.length >= 3) {
        const discount = total * 0.05;
        finalPrice = total - discount;
        if (discountInfo) {
          discountInfo.innerHTML = `<span style="color:var(--ok);font-size:12px;">Diskaun 5% (RM ${discount.toFixed(2)}) diterima.</span>`;
        }
      }

      if (totalPriceElement) totalPriceElement.textContent = finalPrice.toFixed(2);
      updateCTAState();
    }

    function validateCheckout(showAlert = true) {
      const selectedBooks = getSelectedBooks();
      if (selectedBooks.length === 0) {
        if (showAlert) alert('Sila pilih sekurang-kurangnya 1 e-book/e-komik.');
        return false;
      }

      const email = (emailInput?.value || '').trim();
      if (!email) {
        if (showAlert) alert('Sila masukkan email untuk menerima link Google Drive.');
        return false;
      }

      if (emailInput && !emailInput.checkValidity()) {
        if (showAlert) alert('Sila masukkan email yang sah.');
        return false;
      }

      return true;
    }

    function composeMessage() {
      const email = (emailInput?.value || '').trim();
      const selectedBooks = getSelectedBooks();

      const total = selectedBooks.reduce((sum, book) => sum + book.price, 0);
      const finalPrice = selectedBooks.length >= 3 ? total * 0.95 : total;

      const lines = [
        'Hi! Saya dah buat pembayaran untuk ebooks.',
        'Details pembelian:',
        ''
      ];

      selectedBooks.forEach(book => {
        lines.push(`- ${book.title}: RM ${book.price.toFixed(2)}`);
      });

      lines.push('');
      if (selectedBooks.length >= 3) {
        lines.push('Diskaun: 5%');
        lines.push(`Jumlah Asal: RM ${total.toFixed(2)}`);
      }

      lines.push(`Jumlah Bayaran: RM ${finalPrice.toFixed(2)}`);
      lines.push(`Email: ${email}`);

      return encodeURIComponent(lines.join('\n'));
    }

    function openTelegramWithOrder() {
      if (!validateCheckout(true)) return;
      const msg = composeMessage();
      window.open(`https://t.me/${TELEGRAM_USERNAME}?text=${msg}`, '_blank', 'noopener');
    }

    if (addBookBtn) {
      addBookBtn.addEventListener('click', () => {
        const newSelect = createBookSelect();
        bookContainer.appendChild(newSelect);
        newSelect.addEventListener('change', calculateTotal);
        calculateTotal();
      });
    }

    if (emailInput) {
      emailInput.addEventListener('input', updateCTAState);
      emailInput.addEventListener('blur', updateCTAState);
    }

    if (tgLinkEl) {
      tgLinkEl.addEventListener('click', (e) => {
        e.preventDefault();
        openTelegramWithOrder();
      });
    }

    if (paidBtn) {
      paidBtn.addEventListener('click', openTelegramWithOrder);
    }

    document.addEventListener('DOMContentLoaded', () => {
      const initialSelect = createBookSelect();
      bookContainer.appendChild(initialSelect);
      initialSelect.addEventListener('change', calculateTotal);
      calculateTotal();
    });

    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();
  </script>
</body>
</html>
